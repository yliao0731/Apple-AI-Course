<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Intelligence (AI) æ•™å­¸é‡é»æ‡¶äººåŒ…</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ç§»é™¤ Tone.js (èƒŒæ™¯éŸ³æ¨‚å‡½å¼åº«) -->
    <style>
        /* è¨­ç½® Inter å­—é«”ç‚ºå„ªå…ˆï¼Œä¸¦ç¢ºä¿ä¸­æ–‡å­—é«”é¡¯ç¤ºè‰¯å¥½ */
        body {
            font-family: 'Inter', 'Noto Sans TC', 'PingFang TC', sans-serif;
            background-color: #f7f7f7;
            color: #1f2937;
        }
        /* æ¨™é¡Œé…è‰²ä½¿ç”¨ Apple ç›¸é—œçš„æ·±è‰²ç³» */
        .header-bg {
            background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
        }
        /* å¡ç‰‡åº•è‰²ä½¿ç”¨æ·ºè‰²ï¼Œæ­é…åœ“è§’å’Œé™°å½± */
        .card {
            background-color: white;
            border-radius: 1.5rem; /* æ›´åœ“æ½¤çš„åœ“è§’ */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease-in-out;
        }
        .card:hover {
            /* è®“å¡ç‰‡åœ¨æ»‘é¼ æ‡¸åœæ™‚ç•¥å¾®æŠ¬å‡ */
            transform: translateY(-4px);
        }
        /* è¡¨æ ¼æ¨£å¼ */
        .custom-table th, .custom-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        .custom-table th {
            background-color: #f3f4f6;
            color: #4b5563;
            font-weight: 600;
        }
        .custom-table tr:last-child td {
            border-bottom: none;
        }
        /* Accordion å…§å®¹é è¨­éš±è—ï¼Œä½¿ç”¨éæ¸¡æ•ˆæœ */
        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease-out, padding 0.4s ease-out;
            padding: 0 1rem;
        }
        /* å±•é–‹ç‹€æ…‹ */
        .accordion-content.active {
            max-height: 800px; /* å¢åŠ æœ€å¤§é«˜åº¦ä»¥å®¹ç´æ›´å¤šå…§å®¹ */
            padding: 1rem;
        }
        /* ç®­é ­æ—‹è½‰æ•ˆæœ */
        .accordion-icon {
            transition: transform 0.4s;
        }
        .accordion-icon.rotate {
            transform: rotate(180deg);
        }
        /* Loading æ—‹è½‰å‹•ç•« */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
        /* æé†’å‹•ç•« */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            transform: translate3d(0, 0, 0);
        }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* NEW: æŒçºŒæé†’å…‰æšˆ (æ›´æ˜é¡¯çš„è¦–è¦ºéœ‡å‹•/å‚¬ä¿ƒ) */
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(253, 224, 71, 0.7); } /* Yellow-200 */
            70% { box-shadow: 0 0 0 10px rgba(253, 224, 71, 0); }
            100% { box-shadow: 0 0 0 0 rgba(253, 224, 71, 0); }
        }
        .reminder-glow {
            animation: pulse-glow 1.5s infinite;
            border: 2px solid #FDE047; /* Yellow-400 */
        }
    </style>
</head>
<body onclick="resetInactivityTimer()">
    <!-- ä¸»æ¨™é¡Œå€å¡Š -->
    <header class="header-bg text-white p-6 rounded-b-2xl shadow-xl">
        <div class="max-w-4xl mx-auto">
            <div class="flex justify-between items-center mb-2">
                <div>
                    <h1 class="text-2xl sm:text-3xl font-extrabold mb-1">ğŸ“˜ Apple Intelligence (AI) äº’å‹•æ•™æ</h1>
                    <p class="text-sm font-light opacity-80">é»æ“Šå€å¡Šï¼Œæ¢ç´¢ AI æ ¸å¿ƒåŠŸèƒ½ç´°ç¯€ï¼</p>
                </div>
                <!-- å°èˆªæŒ‰éˆ• -->
                <div class="space-x-3 flex items-center">
                    <a href="quiz.html" class="bg-indigo-500 hover:bg-indigo-600 text-white text-sm font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                        å‰å¾€æ¸¬é©—
                    </a>
                    <a href="hub.html" class="bg-gray-500 hover:bg-gray-600 text-white text-sm font-semibold py-2 px-4 rounded-lg transition duration-200 shadow-md">
                        å›ä¸­å¿ƒé 
                    </a>
                </div>
            </div>

            <!-- NPC èªéŸ³å¼•å°å€å¡Š (å°èŠæ© IP) -->
            <div id="npc-container" class="mt-4 p-3 bg-white/10 backdrop-blur-sm rounded-xl flex items-center shadow-lg">
                <!-- åœ–åƒæŒ‰éˆ• - ä½¿ç”¨ä¸Šå‚³çš„ IP åœ–æª” -->
                <button id="speaker-btn" onclick="handleSpeakerClick()" class="relative p-0 mr-3 rounded-full bg-transparent transition duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-300 transform hover:scale-105" aria-label="æ’­æ”¾èªéŸ³å¼•å°">
                    <!-- æ¼«ç•« IP åœ–ç‰‡ (å·²å¾ video æ›¿æ›ç‚º img) -->
                    <img id="speaker-icon" 
                           src="uploaded:è€èŠæ©å»èƒŒ.png-a7f1b070-e704-41fd-85fc-1c478bbb0588" 
                           alt="å°èŠæ© IP åœ–å½¢" 
                           class="w-12 h-12 rounded-full object-cover">
                    
                    <!-- Loading Spinner (çµ•å°å®šä½ç–Šåœ¨åœ–ç‰‡ä¸Šæ–¹) -->
                    <div id="loading-spinner" class="hidden absolute inset-0 rounded-full flex items-center justify-center bg-gray-800/80">
                        <svg class="w-6 h-6 text-white spinner" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="currentColor" d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"/><path fill="currentColor" d="M12 4.5v3a4.5 4.5 0 00-4.5 4.5H4.5A7.5 7.5 0 0112 4.5z"/></svg>
                    </div>
                </button>
                
                <span id="guidance-text" class="text-white text-sm">é»æ“Šé ­åƒï¼Œè†è½å°èŠæ©çš„ä»‹ç´¹ã€‚</span>
            </div>
            
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8 space-y-12">
        
        <!-- ä»‹ç´¹ -->
        <section class="card p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">ç°¡ä»‹ï¼šç³»çµ±å±¤ç´šæ™ºæ…§åŠŸèƒ½</h2>
            <p class="text-gray-600 leading-relaxed">
                Apple Intelligence æ˜¯è˜‹æœå…¬å¸é¦–æ¬¡å°‡ã€ç”Ÿæˆå¼ AI æ¨¡å‹ã€‘æ·±åº¦æ•´åˆåˆ° ã€iOSã€iPadOS å’Œ macOSã€‘ ä¸­çš„ã€ç³»çµ±å±¤ç´šæ™ºæ…§åŠŸèƒ½ã€‘ã€‚å®ƒå°ˆæ³¨æ–¼å€‹äººåŒ–ã€éš±ç§ä¿è­·ï¼Œä¸¦åœ¨æ‰€æœ‰ App ä¸­æä¾›ä¸€è‡´çš„æ™ºæ…§è¼”åŠ©ã€‚
            </p>
        </section>

        <!-- ä¸€ã€ç³»çµ±èˆ‡éš±ç§åŸºç¤ (è¡¨æ ¼ä¸éœ€äº’å‹•ï¼Œä¿æŒåƒè€ƒæ€§) -->
        <section class="card p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="mr-3 text-2xl text-blue-600">ğŸ›¡ï¸</span>ä¸€ã€ç³»çµ±èˆ‡éš±ç§åŸºç¤
            </h2>
            <div class="overflow-x-auto">
                <table class="custom-table w-full min-w-[600px] border-collapse">
                    <thead>
                        <tr>
                            <th class="rounded-tl-xl">é …ç›®</th>
                            <th>èªªæ˜èˆ‡å„ªå‹¢</th>
                            <th class="rounded-tr-xl">æ‡‰ç”¨å ´æ™¯èˆ‰ä¾‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-semibold text-gray-700 w-1/4">ç³»çµ±ç´šæ•´åˆ</td>
                            <td class="w-1/2">AI åŠŸèƒ½æ·±åº¦æ¤å…¥ä½œæ¥­ç³»çµ±æ ¸å¿ƒï¼Œå¯åœ¨ã€æ‰€æœ‰ App (åŸç”Ÿæˆ–ç¬¬ä¸‰æ–¹)ã€‘çš„ã€è¼¸å…¥æ¡†ä¸­èª¿ç”¨ã€‘ã€‚</td>
                            <td class="w-1/4">å¯«éƒµä»¶æ™‚ï¼Œå¯ç«‹å³è«‹ AI èª¿æ•´èªæ°£ç‚ºã€Œå°ˆæ¥­ã€æˆ–ã€Œè¼•é¬†ã€ã€‚</td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700">éš±ç§å„ªå…ˆæ¶æ§‹</td>
                            <td>å„ªå…ˆæ¡ç”¨ ã€è£ç½®ç«¯è™•ç† (On-Device Processing)ã€‘ï¼Œç¢ºä¿ã€å€‹äººè³‡æ–™ä¸é›¢é–‹è£ç½®ã€‘ã€‚</td>
                            <td>ç¸½çµå€‹äººè¨Šæ¯å°è©±å…§å®¹æ™‚ï¼Œæ•¸æ“šå®Œå…¨åœ¨ iPhone å…§é‹ç®—ã€‚</td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700">ç§å¯†é›²ç«¯é‹ç®—</td>
                            <td>è‹¥é‡è¤‡é›œä»»å‹™éœ€è¦é›²ç«¯é‹ç®—ï¼Œå‰‡é€é ã€Private Cloud Compute (PCC)ã€‘ï¼Œä¿è­‰è³‡æ–™ã€ä¸è¢«è˜‹æœå­˜å–æˆ–å„²å­˜ã€‘ã€‚</td>
                            <td>ç”Ÿæˆè¤‡é›œåœ–åƒæ™‚ï¼Œå¯å®‰å…¨åœ°åˆ©ç”¨é›²ç«¯è³‡æºè€Œä¸çŠ§ç‰²éš±ç§ã€‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- äºŒã€ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ› (ä½¿ç”¨äº’å‹•å¼ Accordion) -->
        <section id="core-sections" class="card p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="mr-3 text-2xl text-red-500">âœ¨</span>äºŒã€ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ› (é»æ“Šå±•é–‹)
            </h2>
            <div class="space-y-4">
                
                <!-- 1. å¯«ä½œå·¥å…· -->
                <div id="writing-tools-accordion" class="bg-yellow-100/50 p-4 rounded-lg border-l-4 border-yellow-500 cursor-pointer hover:bg-yellow-100 transition duration-200" onclick="handleAccordionClick('writing-tools')">
                    <h3 class="text-xl font-bold text-gray-800 flex justify-between items-center">
                        1. å¯«ä½œå·¥å…· (Writing Tools)
                        <span id="icon-writing-tools" class="accordion-icon text-xl">â–¼</span>
                    </h3>
                </div>
                <div id="writing-tools" class="accordion-content">
                    <ul class="list-disc list-inside space-y-3 text-gray-700 ml-4 p-4 border-t border-gray-200">
                        <li>ã€ç³»çµ±ç´šå¯«ä½œè¼”åŠ©ã€‘ï¼šå¯åœ¨ç³»çµ±ã€ä»»ä½•æ–‡æœ¬è¼¸å…¥å€åŸŸã€‘ï¼ˆå¦‚éƒµä»¶ã€è¨Šæ¯ã€å‚™å¿˜éŒ„ï¼‰ä¸€éµå‘¼å«ã€‚</li>
                        <li>ã€ä¸»è¦åŠŸèƒ½ã€‘ï¼šã€æ½¤é£¾/é¢¨æ ¼èª¿æ•´ã€‘ï¼ˆæ”¹è®Šèªæ°£ï¼šå°ˆæ¥­ã€è¼•é¬†ã€ç°¡æ½”ï¼‰ã€ã€æ ¡å°/èªæ³•ä¿®æ­£ã€‘ï¼ˆè‡ªå‹•ä¿®æ­£éŒ¯èª¤ä¸¦å»ºè­°å„ªåŒ–ï¼‰ã€ã€ç¸½çµ/æ‘˜è¦ã€‘ï¼ˆå¿«é€Ÿæå–é•·æ–‡é‡é»ï¼‰ã€‚</li>
                        <li class="mt-4 text-sm text-gray-500">ã€è©³ç´°è¨­å®šæ–¹å¼ã€‘ï¼šåœ¨è¼¸å…¥æ¡†ä¸­ã€é•·æŒ‰æˆ–é»æ“Š AI é­”æ³•æ£’åœ–ç¤ºã€‘å³å¯å•Ÿå‹•å¯«ä½œå·¥å…·ã€‚å¯é è¨­ã€é¢¨æ ¼åå¥½ã€‘æˆ–ã€ç›®æ¨™å­—æ•¸ã€‘ç¯„åœã€‚</li>
                    </ul>
                </div>

                <!-- 2. åœ–åƒå‰µä½œ -->
                <div id="image-creation-accordion" class="bg-green-100/50 p-4 rounded-lg border-l-4 border-green-500 cursor-pointer hover:bg-green-100 transition duration-200" onclick="handleAccordionClick('image-creation')">
                    <h3 class="text-xl font-bold text-gray-800 flex justify-between items-center">
                        2. åœ–åƒå‰µä½œ (Image Creation)
                        <span id="icon-image-creation" class="accordion-icon text-xl">â–¼</span>
                    </h3>
                </div>
                <div id="image-creation" class="accordion-content">
                    <ul class="list-disc list-inside space-y-3 text-gray-700 ml-4 p-4 border-t border-gray-200">
                        <li>ã€å½±åƒæ¨‚åœ’ (Image Playground)ã€‘ï¼šé€éã€ç°¡å–®çš„æ–‡å­—æè¿°ã€‘ï¼Œåœ¨ã€è£ç½®ç«¯å¿«é€Ÿç”Ÿæˆã€‘åœ–ç‰‡ã€‚</li>
                        <li>ã€é¢¨æ ¼é¸é …ã€‘ï¼šæ”¯æ´ã€å‹•ç•« (Animation)ã€‘ã€ã€ç´ æ (Sketch)ã€‘ã€ã€æ’ç•« (Illustration)ã€‘ ç­‰å¤šç¨®è—è¡“é¢¨æ ¼ã€‚</li>
                        <li>ã€Genmojiã€‘ï¼šé€éã€è‡ªå®šç¾©æ–‡å­—ã€‘ç”Ÿæˆç¨ç‰¹çš„ã€AI è¡¨æƒ…ç¬¦è™Ÿã€‘ï¼Œå¯ç›´æ¥åœ¨è¨Šæ¯Appä¸­ä½œç‚ºåæ‡‰æˆ–è²¼åœ–ä½¿ç”¨ã€‚</li>
                        <li class="mt-4 text-sm text-gray-500">ã€è©³ç´°è¨­å®šæ–¹å¼ã€‘ï¼šåœ¨ã€Œè¨Šæ¯ Appã€çš„ã€è¼¸å…¥æ¡†å·¦å´é»æ“Š + è™Ÿã€‘ï¼Œé¸æ“‡ ã€å½±åƒæ¨‚åœ’ã€‘ å³å¯é€²å…¥å‰µä½œä»‹é¢ã€‚</li>
                    </ul>
                </div>

                <!-- 3. æƒ…å¢ƒæ„ŸçŸ¥ Siri -->
                <div id="siri-context-accordion" class="bg-purple-100/50 p-4 rounded-lg border-l-4 border-purple-500 cursor-pointer hover:bg-purple-100 transition duration-200" onclick="handleAccordionClick('siri-context')">
                    <h3 class="text-xl font-bold text-gray-800 flex justify-between items-center">
                        3. æƒ…å¢ƒæ„ŸçŸ¥ Siri
                        <span id="icon-siri-context" class="accordion-icon text-xl">â–¼</span>
                    </h3>
                </div>
                <div id="siri-context" class="accordion-content">
                    <ul class="list-disc list-inside space-y-3 text-gray-700 ml-4 p-4 border-t border-gray-200">
                        <li>ã€è¢å¹•å…§å®¹æ„ŸçŸ¥ã€‘ï¼šSiri ç¾åœ¨èƒ½å¤ ã€ç†è§£è¢å¹•ä¸Šæ­£åœ¨é¡¯ç¤ºçš„å…§å®¹ã€‘ï¼Œä¾‹å¦‚ï¼šçœ‹åˆ°æŸå€‹åœ°å€æ™‚ï¼Œå¯ç›´æ¥è¦æ±‚ã€Œå°‡é€™å€‹åœ°å€å„²å­˜åˆ°é€šè¨ŠéŒ„ã€ã€‚</li>
                        <li>ã€è·¨ App è¨˜æ†¶ã€‘ï¼šèƒ½åŸ·è¡Œæ¶‰åŠã€å¤šå€‹æ‡‰ç”¨ç¨‹å¼å’Œè¨˜æ†¶ä¸Šä¸‹æ–‡ã€‘çš„è¤‡é›œæŒ‡ä»¤ã€‚</li>
                        <li>ã€æŒ‡ä»¤ç¯„ä¾‹ã€‘ï¼šä¾‹å¦‚ï¼šã€Œæ‰¾å‡º Jane å‚³çµ¦æˆ‘é—œæ–¼ä¸Šæ¬¡æ—…è¡Œçš„éƒµä»¶è£¡é‚£å¼µã€ç©¿ç´…è‰²å¤–å¥—ã€‘çš„ç…§ç‰‡ã€ã€‚</li>
                        <li class="mt-4 text-sm text-gray-500">ã€è©³ç´°è¨­å®šæ–¹å¼ã€‘ï¼šé è¨­é•·æŒ‰å´é‚ŠæŒ‰éˆ•æˆ–èªéŸ³å–šé†’ï¼Œä½†é ˆåˆ° ã€è¨­å®š > Siri èˆ‡æœå°‹ã€‘ ä¸­é–‹å•Ÿã€è¢å¹•å…§å®¹ä½¿ç”¨æ¬Šé™ã€‘ä»¥å•Ÿå‹•ä¸Šä¸‹æ–‡æ„ŸçŸ¥åŠŸèƒ½ã€‚</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- ä¸‰ã€App æ·±åº¦æ•´åˆæ‡‰ç”¨ -->
        <section class="card p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                <span class="mr-3 text-2xl text-teal-600">ğŸ“±</span>ä¸‰ã€App æ·±åº¦æ•´åˆæ‡‰ç”¨
            </h2>
            <!-- è¡¨æ ¼ç¶­æŒéäº’å‹•å¼ï¼Œä½œç‚ºå¿«é€Ÿåƒè€ƒ -->
            <div class="overflow-x-auto">
                <table class="custom-table w-full min-w-[600px] border-collapse">
                    <thead>
                        <tr>
                            <th class="rounded-tl-xl">App é¡åˆ¥</th>
                            <th class="rounded-tr-xl">ä¸»è¦ AI æ‡‰ç”¨åŠŸèƒ½</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="font-semibold text-gray-700 w-1/3">éƒµä»¶ (Mail)</td>
                            <td class="w-2/3">ã€æ™ºæ…§æ”¶ä»¶ç®±ã€‘ï¼š ã€è‡ªå‹•åˆ†é¡é«˜å„ªå…ˆç´šéƒµä»¶ã€‘ã€‚ã€æ‘˜è¦åŠŸèƒ½ã€‘ï¼š ã€é•·ç¯‡éƒµä»¶ä¸€éµç¸½çµã€‘ï¼Œå¿«é€ŸæŒæ¡é‡é»ã€‚</td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700">æé†’äº‹é … / å‚™å¿˜éŒ„</td>
                            <td>ã€è‡ªå‹•ä»»å‹™å»ºè­°ã€‘ï¼š æ ¹æ“šã€éƒµä»¶ã€è¨Šæ¯ã€è¡Œäº‹æ›†å…§å®¹ã€‘ï¼Œã€ä¸»å‹•å»ºè­°ã€‘ã€ä½¿ç”¨è€…å¯åŠ å…¥çš„å¾…è¾¦äº‹é …æˆ–ä»»å‹™ã€‘ã€‚</td>
                        </tr>
                        <tr>
                            <td class="font-semibold text-gray-700">ç…§ç‰‡ (Photos)</td>
                            <td>ã€æœå°‹å¼·åŒ–ã€‘ï¼š æ”¯æ´ã€è‡ªç„¶èªè¨€æœå°‹ã€‘ï¼Œä¾‹å¦‚ï¼šã€Œã€æ‰¾å‡º Jane ç©¿ç´…è‰²å¤–å¥—åœ¨æµ·é‚Šæ‹çš„ç…§ç‰‡ã€‘ã€ã€‚ã€æ¸…é™¤åŠŸèƒ½ (Clean Up)ã€‘ï¼š ã€æ™ºæ…§ç§»é™¤ç…§ç‰‡ä¸­ä¸éœ€è¦çš„èƒŒæ™¯ç‰©é«”æˆ–äººç‰©ã€‘ã€‚</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

    </main>
    
    <!-- é å°¾ -->
    <footer class="mt-12 p-4 text-center text-gray-500 text-sm">
        &copy; 2025 Apple Intelligence æ•™å­¸è³‡æ–™ - åƒ…ä¾›åƒè€ƒèˆ‡å­¸ç¿’
    </footer>

    <!-- JavaScript for Interactivity and TTS -->
    <script>
        // --- ç‹€æ…‹å’Œé…ç½® ---
        const TTS_MODEL = "gemini-2.5-flash-preview-tts";
        // èªéŸ³å·²æ›´æ”¹ç‚º Puck (æ­¡å¿«/æ´»æ½‘)ï¼ŒåŸç‚º Charon
        const TTS_VOICE = "Puck"; 

        // IP è§’è‰²æ›´åç‚º å°èŠæ©
        const NPC_TITLE = "å°èŠæ©"; 
        // èªéŸ³æ–‡æœ¬ä½¿ç”¨æ–°åç¨±
        const TTS_INITIAL = `å“ˆå›‰ï¼Œæˆ‘æ˜¯ ${NPC_TITLE}ï¼æ­¡è¿ä¾†åˆ° Apple Intelligence èª²ç¨‹ã€‚è«‹é»æ“Šä¸‹æ–¹çš„ã€ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ã€‘å€å¡Šï¼Œé–‹å§‹æ¢ç´¢æ™ºæ…§åŠŸèƒ½å’Œéš±ç§åŸºç¤å§ï¼`; 
        const TTS_REMINDER = `å˜¿ï¼ŒåŒå­¸ï¼æˆ‘æ˜¯ ${NPC_TITLE}ï¼æ™‚é–“åˆ°äº†ï¼Œè«‹è¨˜å¾—é»æ“Šä»»ä¸€æ ¸å¿ƒèƒ½åŠ›å€å¡Š (ä¾‹å¦‚ï¼šå¯«ä½œå·¥å…·) å±•é–‹è©³ç´°å…§å®¹å–”ï¼`;
        const TTS_COMPLETED_PROMPT = "èª²ç¨‹å·²å…¨éƒ¨å®Œæˆï¼è«‹é»æ“Šé ­åƒï¼Œè½å–å‰å¾€æ¸¬é©—çš„å¼•å°ã€‚"; // æ–‡å­—æç¤º
        const TTS_QUIZ_INSTRUCTION = "æ­å–œï¼æ‚¨å·²å®Œæˆä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›çš„å­¸ç¿’ã€‚ç¾åœ¨ï¼Œè«‹é»æ“Šå³ä¸Šè§’çš„ [å‰å¾€æ¸¬é©—] æŒ‰éˆ•ï¼Œæª¢è¦–æ‚¨çš„å­¸ç¿’æˆæœå§ï¼"; // å¯¦éš›èªéŸ³å…§å®¹

        // 1. ä¸åŒçš„è®šç¾æ–¹å¼ & 2. å…§å®¹é‡é»
        const SECTION_PRAISES = {
            // è®šç¾å¤šæ¨£åŒ–
            'writing-tools': "åšå¾—å¤ªæ£’äº†ï¼æ‚¨æˆåŠŸè§£é–äº†ç¬¬ä¸€é …åŠŸèƒ½ï¼Œè¡¨ç¾éå¸¸å„ªç§€ã€‚", 
            'image-creation': "å“‡ï¼Œé€²åº¦ç¥é€Ÿï¼åœ–åƒå‰µä½œæ˜¯ AI æœ€å¸ç›çš„èƒ½åŠ›ä¹‹ä¸€ï¼Œåšå¾—å¾ˆå¥½ã€‚", 
            'siri-context': "å­¸å¾—çœŸå¿«ï¼æƒ…å¢ƒæ„ŸçŸ¥ Siri æ˜¯å¯¦ç¾è·¨æ‡‰ç”¨ç¨‹å¼æ™ºæ…§çš„é—œéµå–”ï¼Œæ‚¨æŒæ¡å¾—éå¸¸æ£’ã€‚" 
        };
        const SECTION_SUMMARIES = { 
            'writing-tools': "ã€å¯«ä½œå·¥å…·ã€‘æ˜¯æ‚¨åœ¨éƒµä»¶ã€å‚™å¿˜éŒ„ä¸­æœ€å¯¦ç”¨çš„ AI åŠ©ç†ã€‚å®ƒèƒ½å¹«æ‚¨ã€ä¸€éµæ½¤é£¾ã€æ ¡å°æˆ–ç¸½çµã€‘é•·ç¯‡æ–‡å­—ï¼Œå¤§å¹…æå‡å¯«ä½œæ•ˆç‡ã€‚",
            'image-creation': "æ‚¨æ­£åœ¨äº†è§£ã€åœ–åƒå‰µä½œã€‘èƒ½åŠ›ã€‚é€™åŒ…å«äº†ã€å½±åƒæ¨‚åœ’ã€‘å’Œ ã€Genmojiã€‘ï¼Œè®“æ‚¨èƒ½å¿«é€Ÿç”Ÿæˆã€å„ç¨®é¢¨æ ¼çš„åœ–ç‰‡ã€‘å’Œã€ç¨ç‰¹çš„è¡¨æƒ…ç¬¦è™Ÿã€‘ã€‚",
            'siri-context': "ã€æƒ…å¢ƒæ„ŸçŸ¥ Siriã€‘æ˜¯ Apple Intelligence çš„æ ¸å¿ƒã€‚å¥¹ç¾åœ¨èƒ½ã€ç†è§£è¢å¹•ä¸Šçš„å…§å®¹ã€‘ï¼Œä¸¦åŸ·è¡Œã€è·¨æ‡‰ç”¨ç¨‹å¼çš„è¤‡é›œæŒ‡ä»¤ã€‘ã€‚"
        };
        
        const completedSections = new Set();
        let inactivityTimer = null;
        let audio = null; 
        // è¿½è¹¤ç•¶å‰çš„èªéŸ³æŒ‡ä»¤ç‹€æ…‹ï¼šinitial -> active (å­¸ç¿’ä¸­) -> quiz_pending_5s (5ç§’å€’æ•¸) -> quiz_ready (å¯é»æ“Šè½å–æ¸¬é©—æŒ‡ä»¤)
        let currentInstruction = 'initial'; 

        // --- DOM å…ƒç´  ---
        const speakerBtn = document.getElementById('speaker-btn');
        const speakerIcon = document.getElementById('speaker-icon');
        const loadingSpinner = document.getElementById('loading-spinner');
        const guidanceText = document.getElementById('guidance-text');
        const coreSectionsContainer = document.getElementById('core-sections');
        const npcContainer = document.getElementById('npc-container'); 
        // ç§»é™¤ musicControl è®Šæ•¸

        // --- æ’­æ”¾èˆ‡æ§åˆ¶é‚è¼¯ ---

        /** * å•Ÿç”¨ Loading ç‹€æ…‹ä¸¦æ›´æ–°æ–‡å­— */
        function startLoading(message) {
            if (audio && !audio.paused) {
                audio.pause();
                audio.currentTime = 0;
            }
            speakerBtn.disabled = true;
            speakerIcon.classList.add('hidden'); // éš±è— IP åœ–åƒ/å½±ç‰‡
            loadingSpinner.classList.remove('hidden'); // é¡¯ç¤º Spinner
            guidanceText.textContent = message;
            // åœæ­¢ç€è¦½å™¨èªéŸ³åˆæˆ
            window.speechSynthesis.cancel(); 
        }

        /** * åœæ­¢ Loading ç‹€æ…‹ä¸¦æ¢å¾©æŒ‰éˆ• */
        function stopLoading(message) {
            guidanceText.textContent = message;
            speakerBtn.disabled = false;
            speakerIcon.classList.remove('hidden'); // é¡¯ç¤º IP åœ–åƒ/å½±ç‰‡
            loadingSpinner.classList.add('hidden'); // éš±è— Spinner
        }
        
        /**
         * ç€è¦½å™¨å…§å»ºèªéŸ³å‚™æ´ (Local Fallback)
         * @param {string} message - è¦èªªçš„æ–‡æœ¬
         */
        function speakLocalFallback(message) {
            startLoading(`ğŸ”Š å‚™æ´èªéŸ³æ’­æ”¾ä¸­... (${NPC_TITLE})`);
            
            const utterance = new SpeechSynthesisUtterance(message);
            utterance.lang = 'zh-TW'; // è¨­å®šç‚ºä¸­æ–‡
            
            utterance.onend = () => {
                stopLoading(`é»æ“Šé ­åƒï¼Œè†è½ ${NPC_TITLE} çš„ä»‹ç´¹ã€‚`);
                if (currentInstruction === 'active') {
                    startInactivityTimer();
                } else if (currentInstruction === 'quiz_ready') {
                    guidanceText.textContent = "è«‹é»æ“Š [å‰å¾€æ¸¬é©—] æŒ‰éˆ•ï¼Œé–‹å§‹æª¢è¦–å­¸ç¿’æˆæœï¼";
                }
            };

            // ç¢ºä¿éŸ³è¨Šæ’­æ”¾çµæŸæ™‚æ‰åœæ­¢ loading
            try {
                 window.speechSynthesis.speak(utterance);
            } catch (error) {
                 console.error("ç€è¦½å™¨èªéŸ³å‚™æ´å¤±æ•—:", error);
                 stopLoading(`å‚™æ´èªéŸ³å¤±æ•—ã€‚è«‹æª¢æŸ¥æ‚¨çš„ç€è¦½å™¨è¨­å®šã€‚`);
            }
        }


        /**
         * è™•ç†å–‡å­æŒ‰éˆ•çš„é»æ“Šäº‹ä»¶ï¼Œæ ¹æ“šç‹€æ…‹æ’­æ”¾æ­£ç¢ºçš„èªéŸ³
         */
        function handleSpeakerClick() {
            if (speakerBtn.disabled) return; 

            // é»æ“ŠæŒ‰éˆ•ï¼Œç§»é™¤æŒçºŒçš„å…‰æšˆæé†’
            npcContainer.classList.remove('reminder-glow');

            let messageToSpeak;

            if (currentInstruction === 'initial' || currentInstruction === 'active') {
                messageToSpeak = TTS_INITIAL;
                currentInstruction = 'active'; 
            } else if (currentInstruction === 'reminder') {
                messageToSpeak = TTS_REMINDER;
                currentInstruction = 'active'; 
            } else if (currentInstruction === 'quiz_ready') {
                 messageToSpeak = TTS_QUIZ_INSTRUCTION;
                 currentInstruction = 'finished'; 
            } else if (currentInstruction === 'quiz_pending_5s' || currentInstruction === 'finished') {
                guidanceText.textContent = currentInstruction === 'finished' ? "èª²ç¨‹å·²çµæŸï¼Œè«‹å‰å¾€æ¸¬é©—ã€‚" : "è«‹ç¨å€™ï¼Œèª²ç¨‹å®Œæˆæé†’å³å°‡ç™¼å‡ºã€‚";
                return;
            }
            
            // é»æ“Šå¾Œéš¨å³å‡ºç¾èªéŸ³ (ç«‹åˆ»å‘¼å« API)
            speakGuidance(messageToSpeak);
            
            coreSectionsContainer.classList.remove('shake');
            document.querySelector('header').classList.remove('shake');
        }

        // --- TTS è¼”åŠ©å‡½æ•¸ (PCM to WAV è½‰æ›) ---
        function base64ToArrayBuffer(base64) {
            const binary_string = window.atob(base64);
            const len = binary_string.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binary_string.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function pcmToWav(samples, sampleRate) {
            const buffer = new ArrayBuffer(44 + samples.length * 2);
            const view = new DataView(buffer);
            
            writeString(view, 0, 'RIFF'); 
            view.setUint32(4, 36 + samples.length * 2, true);
            writeString(view, 8, 'WAVE');
            writeString(view, 12, 'fmt '); 
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true); 
            view.setUint16(22, 1, true); 
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * 2, true);
            view.setUint16(32, 2, true);
            view.setUint16(34, 16, true);
            writeString(view, 36, 'data');
            view.setUint32(40, samples.length * 2, true);

            let offset = 44;
            for (let i = 0; i < samples.length; i++, offset += 2) {
                view.setInt16(offset, samples[i], true);
            }
            
            function writeString(view, offset, string) {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            }
            return new Blob([view], { type: 'audio/wav' });
        }

        async function speakGuidance(message) {
            resetInactivityTimer();
            startLoading(`${NPC_TITLE} æ­£åœ¨ç”ŸæˆèªéŸ³ä¸­ï¼Œè«‹ç¨å€™...`);
            
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${TTS_MODEL}:generateContent?key=${apiKey}`;

            const payload = {
                contents: [{ parts: [{ text: `Say in a relaxed and cheerful tone: ${message}` }] }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: TTS_VOICE } } }
                },
                model: TTS_MODEL
            };

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    const status = response.status;
                    
                    // NEW: 403 éŒ¯èª¤è™•ç†ï¼Œåˆ‡æ›è‡³æœ¬åœ°å‚™æ´èªéŸ³
                    if (status === 403) {
                         console.warn("TTS API æ¬Šé™ä¸è¶³ (403 Forbidden)ã€‚åˆ‡æ›è‡³ç€è¦½å™¨æœ¬åœ°èªéŸ³å‚™æ´ã€‚");
                         stopLoading(`ğŸš¨ éŒ¯èª¤ 403ï¼šAPI æ¬Šé™ä¸è¶³ï¼Œæ­£ä½¿ç”¨æœ¬åœ°å‚™æ´èªéŸ³ã€‚`);
                         speakLocalFallback(message);
                         return; // æˆåŠŸåˆ‡æ›å‚™æ´ï¼ŒçµæŸå‡½å¼
                    }
                    
                    throw new Error(`API éŒ¯èª¤: ${status} ${response.statusText}`);
                }

                const result = await response.json();
                const part = result?.candidates?.[0]?.content?.parts?.[0];
                const audioData = part?.inlineData?.data;
                const mimeType = part?.inlineData?.mimeType;

                if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                    const rateMatch = mimeType.match(/rate=(\d+)/);
                    if (!rateMatch) throw new Error("ç„¡æ³•è§£ææ¡æ¨£ç‡ã€‚");
                    
                    const sampleRate = parseInt(rateMatch[1], 10);
                    const pcmBuffer = base64ToArrayBuffer(audioData);
                    const pcm16 = new Int16Array(pcmBuffer);
                    const wavBlob = pcmToWav(pcm16, sampleRate);
                    const audioUrl = URL.createObjectURL(wavBlob);
                    
                    // ç¢ºä¿æ¯æ¬¡éƒ½å‰µå»ºæ–°çš„ Audio å¯¦ä¾‹
                    audio = new Audio(audioUrl);
                    
                    audio.onplay = () => {
                        guidanceText.textContent = `æ’­æ”¾ä¸­... (${NPC_TITLE}: Puck)`;
                    };
                    audio.onended = () => {
                        stopLoading(`é»æ“Šé ­åƒï¼Œè†è½ ${NPC_TITLE} çš„ä»‹ç´¹ã€‚`);
                        
                        if (currentInstruction === 'active') {
                             startInactivityTimer();
                        } else if (currentInstruction === 'quiz_ready') {
                             guidanceText.textContent = "è«‹é»æ“Š [å‰å¾€æ¸¬é©—] æŒ‰éˆ•ï¼Œé–‹å§‹æª¢è¦–å­¸ç¿’æˆæœï¼";
                        }
                    };
                    // æ’­æ”¾éŸ³è¨Š
                    audio.play();
                } else {
                    throw new Error("API è¿”å›çš„éŸ³è¨Šæ•¸æ“šçµæ§‹ç„¡æ•ˆæˆ–ç¼ºå°‘æ•¸æ“šã€‚");
                }
            } catch (error) {
                console.error("TTS ç™¼ç”Ÿåš´é‡éŒ¯èª¤:", error);
                // æœ€çµ‚å‚™æ´ï¼šå¦‚æœé€£å‚™æ´éƒ½å¤±æ•—ï¼Œå‰‡åˆ‡æ›è‡³æœ¬åœ°å‚™æ´
                speakLocalFallback(message);
            }
        }


        // --- èª²ç¨‹ç‹€æ…‹èˆ‡è¨ˆæ™‚å™¨é‚è¼¯ (ä¿æŒåŸæ¨£) ---
        
        /** * å•Ÿå‹• 5 ç§’ä¸æ´»å‹•æé†’è¨ˆæ™‚å™¨ */
        function startInactivityTimer() {
            clearTimeout(inactivityTimer);
            if (currentInstruction === 'active') {
                inactivityTimer = setTimeout(() => {
                    // é”åˆ° 5 ç§’å‚¬ä¿ƒé»
                    currentInstruction = 'reminder';
                    guidanceText.textContent = "è¶…é 5 ç§’æœªäº’å‹•ï¼è«‹é»æ“Šé ­åƒï¼Œè†è½å°èŠæ©çš„å‚¬ä¿ƒæé†’ï¼";
                    coreSectionsContainer.classList.add('shake'); // æ ¸å¿ƒå€å¡Šæ™ƒå‹• (ç¬æ™‚)
                    setTimeout(() => coreSectionsContainer.classList.remove('shake'), 1000);
                    
                    // ç¶­æŒéœ‡å‹•/é–ƒçˆç›´åˆ°é»æ“Š (ä½¿ç”¨æŒçºŒå…‰æšˆ)
                    npcContainer.classList.add('reminder-glow'); 

                }, 5000); 
            }
        }

        /** * é‡è¨­ä¸æ´»å‹•è¨ˆæ™‚å™¨ */
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            // ç§»é™¤å…‰æšˆï¼Œç„¡è«–æ˜¯å¦åœ¨æé†’ç‹€æ…‹
            npcContainer.classList.remove('reminder-glow'); 
            
            if (currentInstruction === 'active') {
                startInactivityTimer();
            }
        }

        /**
         * è™•ç† Accordion é»æ“Šäº‹ä»¶ï¼ŒåŒ…å«ç‹€æ…‹è¿½è¹¤å’ŒèªéŸ³åé¥‹
         */
        function handleAccordionClick(id) {
            resetInactivityTimer(); 
            
            toggleAccordion(id);
            
            const content = document.getElementById(id);
            if (!content.classList.contains('active')) {
                return;
            }
            
            // æª¢æŸ¥æ˜¯å¦å·²å®Œæˆï¼Œä¸¦çµ¦äºˆåé¥‹
            if (!completedSections.has(id)) {
                completedSections.add(id);
                
                // ä¸åŒçš„è®šç¾æ–¹å¼ + å…§å®¹ç¸½çµ
                const praise = SECTION_PRAISES[id];
                const summary = SECTION_SUMMARIES[id];
                const fullMessage = `${praise}ï¼æ‚¨æˆåŠŸå±•é–‹äº†å€å¡Šã€‚æ¥è‘—ï¼Œ${summary}`;
                
                // èªéŸ³å‡ºç¾çš„é€Ÿåº¦ (é»æ“Šå¾Œéš¨å³é–‹å§‹ API å‘¼å«)
                speakGuidance(fullMessage);
                
                // æª¢æŸ¥èª²ç¨‹å®Œæˆåº¦
                if (completedSections.size === 3) {
                    // é€²å…¥ 5 ç§’å€’æ•¸ç‹€æ…‹
                    currentInstruction = 'quiz_pending_5s';
                    
                    // èª²ç¨‹å®Œæˆå¾Œ 5 ç§’æé†’
                    setTimeout(() => {
                        if (currentInstruction === 'quiz_pending_5s') {
                            currentInstruction = 'quiz_ready'; 
                            guidanceText.textContent = TTS_COMPLETED_PROMPT; 
                            // é ‚éƒ¨å€å¡Šæ™ƒå‹• (ç¬æ™‚)
                            document.querySelector('header').classList.add('shake'); 
                            setTimeout(() => document.querySelector('header').classList.remove('shake'), 1000);

                            // ç¶­æŒé–ƒçˆç›´åˆ°é»æ“Š
                            npcContainer.classList.add('reminder-glow');
                        }
                    }, 5000); 
                } else {
                    currentInstruction = 'active'; 
                }
            } else {
                 guidanceText.textContent = "æ‚¨å·²ç¶“å­¸éé€™ä¸€å€å¡Šå›‰ï¼";
                 currentInstruction = 'active';
            }

            coreSectionsContainer.classList.remove('shake');
        }

        // --- è¼”åŠ©å‡½æ•¸ï¼šAccordion å±•é–‹/æ”¶åˆé‚è¼¯ (ä¿æŒåŸæ¨£) ---
        function toggleAccordion(id) {
            const content = document.getElementById(id);
            const icon = document.getElementById(`icon-${id}`);
            
            const isActive = content.classList.contains('active');

            document.querySelectorAll('.accordion-content').forEach(item => {
                if (item.id !== id) {
                    item.classList.remove('active');
                    item.style.maxHeight = 0;
                }
            });
            document.querySelectorAll('.accordion-icon').forEach(item => {
                if (item.id !== `icon-${id}`) {
                    item.classList.remove('rotate');
                }
            });

            if (!isActive) {
                content.classList.add('active');
                // ä½¿ç”¨ scrollHeight ç¢ºä¿å…§å®¹å®Œå…¨å±•é–‹
                content.style.maxHeight = content.scrollHeight + 100 + "px"; 
                icon.classList.add('rotate');
            } else {
                content.classList.remove('active');
                content.style.maxHeight = 0;
                icon.classList.remove('rotate');
            }
        }


        // --- é é¢åˆå§‹åŒ– ---
        window.addEventListener('load', () => {
            // åˆå§‹æç¤ºåœ¨ DOM ä¸­è¨­ç½®ï¼Œç­‰å¾…ç”¨æˆ¶é»æ“Šé ­åƒæŒ‰éˆ•
            guidanceText.textContent = `é»æ“Šé ­åƒï¼Œé–‹å§‹ ${NPC_TITLE} çš„ä»‹ç´¹ã€‚`;
            
            document.querySelectorAll('.accordion-content').forEach(content => {
                if (!content.classList.contains('active')) {
                    content.style.maxHeight = 0;
                }
            });
        });
    </script>
</body>
</html>
